# learn-webassembly

Prerequisites to run the examples:

- Ensure wat-wasm and assemblyscript npm packages are globally installed
- Ensure @assemblyscript/loader is installed

## Snapshot

This is an example to save and restore webassembly runtime state. It assumes that table is not used, and stack is empty at time of save/restore. Then it save/restore globals (we call it regs) to memory. In the end, all states are captured in memory. The inspiration comes from [Wizer](https://www.youtube.com/watch?v=C6pcWRpHWG0).

To roughly prove it's working, we build a todo app, which is a Map from key to value, instead of array. Then we modify the todo, save snapshot of all state and later restore it, to see if todo is recovered.

The files are in snapshot folder:

- todo.ts and todo.js: todo app main logic written in AssemblyScript and Javascript
- regs.wat: the globals (register) save/restore wat code, to be injected into compiled AssemblyScript. To know which globals to save/restore, we need to look at the wat compiled from AssemblyScript, and find all mutable globals
- todo.sh: compilation script
- todo.wat: automatically generated by todo.sh

To run the experiment:

- First go to snapshot folder and compile: `sh ./todo.sh`
- Then run the app: `node ./todo.js`
